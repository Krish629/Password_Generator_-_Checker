<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cyber Password Toolkit ‚Äî Generator + Checker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family:'Poppins',sans-serif; }

    
    :root{
      
      --bg-dark: #0f172a;
      --card-dark: rgba(18,28,46,0.92);
      --text-dark: #e6eef6;
      --accent-dark: #38bdf8;
      --matrix-dark: #00FF00;

      
      --bg-light-start: #f0f9ff;   
      --bg-light-end:   #e0f2fe;   
      --card-light: rgba(255,255,255,0.98);
      --text-light: #0c4a6e;       
      --accent-light: #0284c7;     
      --matrix-light: #0ea5e9;     
      --secondary-light: #f97316;  
      --success-light: #16a34a;    
      --warning-light: #eab308;    
      --danger-light: #dc2626;     
    }

    
    body {
      background:var(--bg-dark);
      color:var(--text-dark);
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      min-height:100vh; overflow-x:hidden; transition: background .5s ease, color .45s ease;
    }

    canvas#matrix { position:fixed; inset:0; width:100%; height:100%; z-index:-1; background:var(--bg-dark); transition: filter .4s, opacity .4s; }

    
    #splash {
      position:fixed; inset:0; z-index:30; display:flex; flex-direction:column; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(2,6,23,0.92), rgba(3,7,28,0.92));
      color:var(--accent-dark); gap:8px;
      animation: splashFade 2s ease 2.6s forwards;
    }
    @keyframes splashFade { to { opacity:0; visibility:hidden; } }

    
    header { margin-top:28px; z-index:2; display:flex; gap:14px; align-items:center; flex-direction:column; text-align:center; }
    h1 {
      margin:0; font-size:1.8rem; color:#bfe9ff;
      text-shadow:0 0 14px rgba(56,189,248,0.25), 0 0 28px rgba(56,189,248,0.12);
      animation: glow 2.2s infinite alternate;
    }
    @keyframes glow {
      from { text-shadow:0 0 10px rgba(56,189,248,0.18); }
      to { text-shadow:0 0 30px rgba(14,165,233,0.28); }
    }
    .subtitle { color:#9fbad0; font-size:0.95rem; margin-top:6px; }

    
    .container { display:grid; grid-template-columns:repeat(2,360px); gap:20px; margin:26px; z-index:2; }

    
    .card {
      width:100%; background:var(--card-dark); border-radius:14px; padding:22px;
      box-shadow: 0 10px 40px rgba(6,15,30,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
      transform: translateZ(0);
      transition: transform .25s cubic-bezier(.2,.9,.3,1), box-shadow .25s, background .45s, color .45s, border-color .45s;
      border:1px solid rgba(56,189,248,0.06);
    }
    .card:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 22px 70px rgba(6,15,30,0.6); }

    
    button {
      cursor:pointer; border:none; border-radius:10px; padding:10px 16px; font-weight:700;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      transition: transform .12s, box-shadow .12s, filter .12s, background .18s;
      font-size:0.95rem;
    }
    button:active { transform: translateY(2px); }

    .btn-primary { background:var(--accent-dark); color:#042331; box-shadow: 0 12px 36px rgba(56,189,248,0.12); border:1px solid rgba(56,189,248,0.12); }
    .btn-primary:hover { filter:brightness(1.03); box-shadow: 0 20px 48px rgba(56,189,248,0.18); }

    .btn-qr { background:#7c3aed; color:white; box-shadow: 0 12px 30px rgba(124,58,237,0.12); border:1px solid rgba(124,58,237,0.12); }
    .btn-copy { background:#22c55e; color:#042331; box-shadow: 0 12px 30px rgba(34,197,94,0.10); border:1px solid rgba(34,197,94,0.08); }
    .btn-toggle { background:transparent; color:var(--accent-dark); padding:8px 12px; border-radius:999px; display:flex; align-items:center; gap:8px; border:1px solid rgba(255,255,255,0.04); }

    
    input[type="text"], input[type="password"], input[type="number"] {
      width:85%; margin:10px 0; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
      background:#243241; color:var(--text-dark); outline:none; text-align:center; letter-spacing:1px; transition: background .3s, color .3s, border-color .3s;
    }
    input[type="number"] { width:100px; }

    
    .options { text-align:left; margin-top:8px; color:#cfeaf6; font-size:0.92rem; }
    .options label { display:block; margin:6px 0; }

    
    .strength-row { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-top:10px; }
    .strength-bar { width:76%; height:10px; background:#263446; border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.02); }
    .strength-bar > div { height:100%; width:0%; transition: width .28s ease, background .28s; }
    .strength-num { width:20%; text-align:right; color:#9fe7ff; font-weight:800; }

    
    .history { margin-top:12px; text-align:left; color:#bfe8ff; font-size:0.95rem; }
    .history-list { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .hist-item { display:flex; gap:8px; align-items:center; justify-content:space-between; background:rgba(0,0,0,0.12); padding:8px 10px; border-radius:8px; }
    .hist-text { font-family:monospace; letter-spacing:1px; color:#e8f8ff; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:170px; }
    .hist-actions { display:flex; gap:6px; }

    
    .verdict { margin-top:10px; font-weight:700; color:#cfeaf6; }

    
    footer { margin:26px 0 60px; color:#8faec8; font-size:0.9rem; z-index:2; }

    
    .modal-backdrop { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,0.6); z-index:60; visibility:hidden; opacity:0; transition:opacity .24s, visibility .24s; }
    .modal { width:320px; max-width:92%; background:linear-gradient(180deg, rgba(10,18,34,0.96), rgba(14,20,36,0.98)); border-radius:12px; padding:18px; text-align:center; transform: scale(.85); transition: transform .24s cubic-bezier(.2,.9,.3,1); box-shadow: 0 30px 80px rgba(0,0,0,0.6); border:1px solid rgba(56,189,248,0.06); }
    .modal.show { transform: scale(1); }
    .backdrop-show { visibility:visible; opacity:1; }

    
    .row { display:flex; gap:10px; align-items:center; justify-content:center; }
    .muted { color:#90b3c6; font-size:0.9rem; }

    
    body.light-mode {
      background: linear-gradient(180deg, var(--bg-light-start), var(--bg-light-end));
      color: var(--text-light);
    }
    body.light-mode canvas#matrix { background: linear-gradient(180deg, var(--bg-light-start), var(--bg-light-end)); }
    body.light-mode .card { 
      background: var(--card-light); 
      color: var(--text-light); 
      border:1px solid rgba(2,74,110,0.15); 
      box-shadow: 0 10px 30px rgba(2,74,110,0.1); 
    }
    body.light-mode .subtitle { color: var(--text-light); opacity: 0.8; }
    body.light-mode h1 {
      color: var(--accent-light);
      text-shadow: 0 0 14px rgba(2,132,199,0.25), 0 0 28px rgba(2,132,199,0.12);
    }
    body.light-mode h2 {
      color: var(--text-light);
    }

    body.light-mode input[type="text"], body.light-mode input[type="password"], body.light-mode input[type="number"] {
      background: #f8fafc; 
      color: var(--text-light); 
      border:1px solid rgba(2,74,110,0.2);
    }

    
    body.light-mode .btn-primary { 
      background: var(--accent-light); 
      color: white; 
      box-shadow: 0 12px 36px rgba(2,132,199,0.25); 
      border:1px solid rgba(2,132,199,0.2); 
    }
    body.light-mode .btn-copy { 
      background: var(--success-light); 
      color: white; 
      box-shadow: 0 12px 30px rgba(22,163,74,0.25); 
      border:1px solid rgba(22,163,74,0.2); 
    }
    body.light-mode .btn-qr { 
      background: var(--secondary-light); 
      color: white; 
      box-shadow: 0 10px 30px rgba(249,115,22,0.25); 
      border:1px solid rgba(249,115,22,0.2); 
    }
    body.light-mode .btn-toggle { 
      background: rgba(2,132,199,0.1); 
      color: var(--accent-light); 
      border:1px solid rgba(2,132,199,0.2); 
    }

    body.light-mode .options { color: var(--text-light); }
    body.light-mode .history { color: var(--text-light); }
    body.light-mode .hist-item { background: rgba(2,132,199,0.08); }
    body.light-mode .hist-text { color: var(--text-light); }
    body.light-mode .strength-bar { background: rgba(2,74,110,0.1); }
    body.light-mode .strength-num { color: var(--accent-light); }
    body.light-mode .verdict { color: var(--text-light); }
    body.light-mode .muted { color: var(--text-light); opacity: 0.7; }
    body.light-mode footer { color: var(--text-light); opacity: 0.8; }
    body.light-mode .modal { 
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98)); 
      color: var(--text-light);
      box-shadow: 0 30px 80px rgba(2,74,110,0.2);
      border:1px solid rgba(2,132,199,0.15);
    }
    body.light-mode #qrTitle { color: var(--accent-light); }

    
    @media (max-width:920px) { .container { grid-template-columns:1fr; } .card { width:92%; margin:0 auto; } header { margin-top:14px; } }
    @media (max-width:420px) { h1{font-size:1.3rem;} .subtitle{font-size:0.85rem;} .strength-num{font-size:0.86rem;} }
  
  </style>
</head>
<body>
  <canvas id="matrix" aria-hidden="true"></canvas>

  <div id="splash">
    <h2>Initializing Cybersecurity Toolkit...</h2>
    <div class="muted">Loading matrix, modules & security engines üîê</div>
  </div>

  <header>
    <h1>üõ°Ô∏è Cyber Password Toolkit</h1>
    <div class="subtitle">Generator ‚Ä¢ Strength Checker ‚Ä¢ QR export ‚Ä¢ History ‚Ä¢ Neon UI</div>
  </header>

  <div style="margin-top:14px; z-index:2;">
    <button id="modeBtn" class="btn-toggle" aria-pressed="false"><span id="modeIcon">üåô</span> <span id="modeLabel">Dark Mode</span></button>
  </div>

  <main class="container" role="main" aria-live="polite">
    
    <section class="card" aria-labelledby="genTitle">
      <h2 id="genTitle" style="margin-top:0; margin-bottom:6px;">üîê Password Generator</h2>

      <input id="passwordDisplay" type="text" readonly placeholder="Click Generate" aria-label="Generated password" />

      <div class="strength-row">
        <div class="strength-bar" aria-hidden="true"><div id="strengthLevel"></div></div>
        <div class="strength-num" id="strengthValue">0/100</div>
      </div>

      <div class="options" aria-label="Options">
        <label><input id="includeUppercase" type="checkbox" checked /> Include Uppercase</label>
        <label><input id="includeLowercase" type="checkbox" checked /> Include Lowercase</label>
        <label><input id="includeNumbers" type="checkbox" checked /> Include Numbers</label>
        <label><input id="includeSymbols" type="checkbox" checked /> Include Symbols</label>
        <label style="margin-top:6px;">Length: <input id="length" type="number" min="4" max="40" value="12" /></label>
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="generateBtn" class="btn-primary">Generate</button>
        <button id="copyBtn" class="btn-copy">Copy</button>
        <button id="qrBtn" class="btn-qr">Generate QR</button>
      </div>

      <div class="history" aria-live="polite">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div style="font-weight:700; color:#cfeaff;">Password History</div>
          <div class="muted" style="font-size:0.85rem;">last 5 (local)</div>
        </div>
        <div class="history-list" id="historyList" style="margin-top:8px;"></div>
      </div>

      <div id="genMsg" class="message" style="height:20px; margin-top:12px; color:#a8f0bd;"></div>
    </section>

    
    <section class="card" aria-labelledby="checkTitle">
      <h2 id="checkTitle" style="margin-top:0; margin-bottom:6px;">üß† Password Strength Checker</h2>

      <input id="checkInput" type="password" placeholder="Type a password to check" aria-label="Password checker input" />
      <div class="strength-row">
        <div class="strength-bar"><div id="checkLevel"></div></div>
        <div class="strength-num" id="checkValue">0/100</div>
      </div>

      <div id="verdict" class="verdict">Enter a password to evaluate</div>

      <div style="margin-top:14px; color:#bcdff5; font-size:0.92rem;">
        <strong>Tips:</strong>
        <ul style="margin:8px 0 0 18px; padding:0; line-height:1.4;">
          <li>Use length ‚â• 12 for strong passwords</li>
          <li>Mix uppercase, lowercase, numbers, symbols</li>
        </ul>
      </div>
    </section>
  </main>

  <footer>¬© 2025 ‚Äî Cyber Password Toolkit ‚Ä¢ Built for portfolio / college project</footer>

  
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div id="modal" class="modal" role="document" aria-labelledby="qrTitle">
      <h3 id="qrTitle" style="margin-top:0; color:#bfe8ff;">QR Code</h3>
      <p id="qrSubtitle" class="muted">Scan this code to quickly transfer the password</p>
      <div id="qrContainer" style="margin:12px 0; display:flex; align-items:center; justify-content:center;"></div>
      <div style="display:flex; justify-content:center; gap:10px; margin-top:12px;">
        <button id="saveQrBtn" class="btn-primary">Save PNG</button>
        <button id="closeModal" class="btn-qr">Close</button>
      </div>
    </div>
  </div>

  <script>
  
  (function matrixInit(){
    const canvas = document.getElementById('matrix');
    const ctx = canvas.getContext('2d');
    let fontSize = 16;
    let cols = 0;
    let drops = [];
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*";
    window.matrixColor = '#00FF00'; 
    let animationId = null;

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      fontSize = 16;
      cols = Math.floor(canvas.width / fontSize);
      drops = new Array(cols).fill(1).map(_ => Math.floor(Math.random()*canvas.height/fontSize));
      ctx.font = fontSize + "px monospace";
    }
    window.addEventListener('resize', resize);
    resize();

    function draw(){
      
      if (document.body.classList.contains('light-mode')) {
        ctx.fillStyle = "rgba(240,249,255,0.12)";
      } else {
        ctx.fillStyle = "rgba(15,23,42,0.12)";
      }
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = window.matrixColor || '#00FF00';
      ctx.font = fontSize + "px monospace";
      for (let i=0;i<drops.length;i++){
        const text = chars.charAt(Math.floor(Math.random() * chars.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      }
      animationId = requestAnimationFrame(draw);
    }
    
    
    draw();
    
    
    window.stopMatrix = function() {
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
    };
    
    window.setMatrixColor = (hex) => { window.matrixColor = hex; };
  })();

  
  (function appInit(){
    
    const passwordDisplay = document.getElementById('passwordDisplay');
    const includeUppercase = document.getElementById('includeUppercase');
    const includeLowercase = document.getElementById('includeLowercase');
    const includeNumbers = document.getElementById('includeNumbers');
    const includeSymbols = document.getElementById('includeSymbols');
    const lengthInput = document.getElementById('length');
    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const qrBtn = document.getElementById('qrBtn');
    const genMsg = document.getElementById('genMsg');
    const strengthLevel = document.getElementById('strengthLevel');
    const strengthValue = document.getElementById('strengthValue');

    const checkInput = document.getElementById('checkInput');
    const checkLevel = document.getElementById('checkLevel');
    const checkValue = document.getElementById('checkValue');
    const verdict = document.getElementById('verdict');

    const historyList = document.getElementById('historyList');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modal = document.getElementById('modal');
    const qrContainer = document.getElementById('qrContainer');
    const closeModal = document.getElementById('closeModal');
    const saveQrBtn = document.getElementById('saveQrBtn');

    const modeBtn = document.getElementById('modeBtn');
    const modeIcon = document.getElementById('modeIcon');
    const modeLabel = document.getElementById('modeLabel');

    const upperChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const lowerChars = "abcdefghijklmnopqrstuvwxyz";
    const numberChars = "0123456789";
    const symbolChars = "!@#$%^&*()_+[]{}|:,.<>?/~`";

    const HIST_KEY = 'cyber_pw_history_v1';

    loadHistory();
    bindEvents();

    function bindEvents(){
      generateBtn.addEventListener('click', onGenerate);
      copyBtn.addEventListener('click', onCopy);
      qrBtn.addEventListener('click', openQrModal);
      closeModal.addEventListener('click', closeQrModal);
      saveQrBtn.addEventListener('click', saveQrImage);
      checkInput.addEventListener('input', onCheckInput);
      modeBtn.addEventListener('click', toggleTheme);
      modalBackdrop.addEventListener('click', (e)=> { if (e.target === modalBackdrop) closeQrModal(); });
      
      
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'g') {
          e.preventDefault();
          onGenerate();
        }
        if (e.ctrlKey && e.key === 'c' && document.activeElement !== passwordDisplay) {
          e.preventDefault();
          onCopy();
        }
        if (e.key === 'Escape' && modalBackdrop.classList.contains('backdrop-show')) {
          closeQrModal();
        }
      });
    }

    
    function toggleTheme(){
      const isLight = document.body.classList.toggle('light-mode');
      if (isLight) {
        modeIcon.textContent = '‚òÄÔ∏è';
        modeLabel.textContent = 'Light Mode';
        
        window.setMatrixColor('#0ea5e9');
        
        document.querySelector('canvas#matrix').style.filter = 'brightness(1.1) hue-rotate(200deg) saturate(1.2)';
        
      } else {
        modeIcon.textContent = 'üåô';
        modeLabel.textContent = 'Dark Mode';
        window.setMatrixColor('#00FF00');
        document.querySelector('canvas#matrix').style.filter = 'none';
      }
      modeBtn.animate([{ transform: 'scale(.98)' }, { transform: 'scale(1.03)' }, { transform: 'scale(1)' }], { duration: 260, easing:'ease-out' });
    }

    
    function onGenerate(){
      const len = parseInt(lengthInput.value) || 12;
      let pool = '';
      if (includeUppercase.checked) pool += upperChars;
      if (includeLowercase.checked) pool += lowerChars;
      if (includeNumbers.checked) pool += numberChars;
      if (includeSymbols.checked) pool += symbolChars;

      if (!pool) {
        passwordDisplay.value = 'Select at least one option!';
        genMsg.textContent = 'Choose at least one character type';
        genMsg.style.color = '#fca5a5';
        return;
      }

      
      let password = '';
      try {
        const array = new Uint32Array(len);
        window.crypto.getRandomValues(array);
        for (let i=0; i<len; i++){
          const rnd = array[i] % pool.length;
          password += pool.charAt(rnd);
        }
      } catch (e) {
        for (let i=0;i<len;i++){
          const rnd = Math.floor(Math.random() * pool.length);
          password += pool.charAt(rnd);
        }
      }

      passwordDisplay.value = password;
      updateStrength(password, strengthLevel, strengthValue);
      saveToHistory(password);
      genMsg.textContent = 'Generated ‚úì';
      genMsg.style.color = '#0ea5a4';
      setTimeout(()=> genMsg.textContent = '', 1800);
    }

    
    function onCopy(){
      const pwd = passwordDisplay.value;
      if (!pwd) return;
      navigator.clipboard.writeText(pwd).then(()=>{
        genMsg.textContent = 'Copied to clipboard!';
        genMsg.style.color = '#0ea5a4';
        setTimeout(()=> genMsg.textContent = '', 1800);
      }).catch(()=>{
        
        const textArea = document.createElement('textarea');
        textArea.value = pwd;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        genMsg.textContent = 'Copied to clipboard!';
        genMsg.style.color = '#0ea5a4';
        setTimeout(()=> genMsg.textContent = '', 1800);
      });
    }

    
    function updateStrength(password, barEl, valEl) {
      let score = 0;
      if (password.length >= 8) score += 15;
      if (password.length >= 12) score += 10;
      if (password.length >= 16) score += 5;
      if (/[A-Z]/.test(password)) score += 20;
      if (/[a-z]/.test(password)) score += 20;
      if (/[0-9]/.test(password)) score += 20;
      if (/[^A-Za-z0-9]/.test(password)) score += 15;
      
      
      const hasUpper = /[A-Z]/.test(password);
      const hasLower = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSymbol = /[^A-Za-z0-9]/.test(password);
      
      if (hasUpper && hasLower && hasNumber && hasSymbol) score += 10;

      if (score > 100) score = 100;
      if (score < 0) score = 0;

      if (barEl) {
        barEl.style.width = score + '%';
        if (score <= 40) barEl.style.background = '#ef4444';
        else if (score <= 80) barEl.style.background = '#facc15';
        else barEl.style.background = '#22c55e';
      }
      if (valEl) valEl.textContent = score + '/100';
      return score;
    }

    
    function onCheckInput(){
      const val = checkInput.value;
      if (!val) {
        checkLevel.style.width = '0%';
        checkValue.textContent='0/100';
        verdict.textContent = 'Enter a password to evaluate';
        verdict.style.color = '#cfeaf6';
        return;
      }
      const s = updateStrength(val, checkLevel, checkValue);
      let text = 'Weak ‚ùå', color='#ef4444';
      if (s >= 85) { text = 'Very Strong ‚úÖ'; color='#22c55e'; }
      else if (s >= 70) { text = 'Strong ‚úÖ'; color='#22c55e'; }
      else if (s >= 45) { text = 'Medium ‚ö†Ô∏è'; color='#facc15'; }
      verdict.textContent = text;
      verdict.style.color = color;
    }

    
    function loadHistory(){
      const raw = localStorage.getItem(HIST_KEY);
      let arr = [];
      try { arr = raw ? JSON.parse(raw) : []; } catch(e) { arr = []; }
      renderHistory(arr);
    }

    function saveToHistory(password){
      try {
        const raw = localStorage.getItem(HIST_KEY);
        let arr = raw ? JSON.parse(raw) : [];
        arr = arr.filter(p => p !== password);
        arr.unshift(password);
        if (arr.length > 5) arr = arr.slice(0,5);
        localStorage.setItem(HIST_KEY, JSON.stringify(arr));
        renderHistory(arr);
      } catch (e) { console.warn('History save failed', e); }
    }

    function renderHistory(arr){
      historyList.innerHTML = '';
      if (!arr || arr.length === 0) {
        historyList.innerHTML = '<div class="muted" style="padding:8px 0;">No history yet ‚Äî generate a password</div>';
        return;
      }
      arr.forEach((pwd) => {
        const item = document.createElement('div');
        item.className = 'hist-item';
        const text = document.createElement('div');
        text.className = 'hist-text';
        const masked = maskPwd(pwd);
        text.textContent = masked;
        text.dataset.revealed = '0';
        const actions = document.createElement('div');
        actions.className = 'hist-actions';

        const useBtn = document.createElement('button');
        useBtn.className = 'btn-qr';
        useBtn.textContent = 'Use';
        useBtn.addEventListener('click', ()=> {
          passwordDisplay.value = pwd;
          updateStrength(pwd, strengthLevel, strengthValue);
          genMsg.textContent = 'Loaded from history';
          setTimeout(()=>genMsg.textContent='',1400);
        });

        const copyBtn = document.createElement('button');
        copyBtn.className = 'btn-copy';
        copyBtn.title = 'Copy password';
        copyBtn.textContent = 'Copy';
        copyBtn.addEventListener('click', () => {
          navigator.clipboard.writeText(pwd).then(()=> {
            genMsg.textContent = 'Password copied from history!';
            setTimeout(()=> genMsg.textContent = '', 1500);
          }).catch(() => {
            
            const textArea = document.createElement('textarea');
            textArea.value = pwd;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            genMsg.textContent = 'Password copied from history!';
            setTimeout(()=> genMsg.textContent = '', 1500);
          });
        });

        const revealBtn = document.createElement('button');
        revealBtn.className = 'btn-primary';
        revealBtn.textContent = 'Show';
        revealBtn.addEventListener('click', () => {
          if (text.dataset.revealed === '1') {
            text.textContent = maskPwd(pwd);
            text.dataset.revealed = '0';
            revealBtn.textContent = 'Show';
          } else {
            text.textContent = pwd;
            text.dataset.revealed = '1';
            revealBtn.textContent = 'Hide';
          }
        });

        actions.appendChild(useBtn);
        actions.appendChild(copyBtn);
        actions.appendChild(revealBtn);

        item.appendChild(text);
        item.appendChild(actions);
        historyList.appendChild(item);
      });
    }

    function maskPwd(pw){
      if (pw.length <= 6) return pw.replace(/.(?=.{2})/g, '‚Ä¢');
      const first = pw.slice(0,2);
      const last = pw.slice(-2);
      return first + ' ‚Ä¢‚Ä¢‚Ä¢ ' + last;
    }

    
    function openQrModal(){
      const pwd = passwordDisplay.value || '';
      if (!pwd) {
        genMsg.textContent = 'No password to create QR!';
        genMsg.style.color = '#fca5a5';
        setTimeout(()=>genMsg.textContent='',1400);
        return;
      }
      
      
      createQRCode(pwd).then(dataUrl => {
        qrContainer.innerHTML = '';
        const img = document.createElement('img');
        img.src = dataUrl;
        img.alt = 'QR code';
        img.style.width = '260px';
        img.style.height = '260px';
        img.style.borderRadius = '8px';
        img.style.boxShadow = '0 12px 40px rgba(0,0,0,0.5)';
        qrContainer.appendChild(img);

        modalBackdrop.classList.add('backdrop-show');
        modal.classList.add('show');
        
        
        window.currentQRDataUrl = dataUrl;
      }).catch(error => {
        console.error('QR generation failed:', error);
        genMsg.textContent = 'Failed to generate QR code';
        genMsg.style.color = '#fca5a5';
        setTimeout(()=>genMsg.textContent='',1400);
      });
    }

    function closeQrModal() {
      modalBackdrop.classList.remove('backdrop-show');
      modal.classList.remove('show');
    }

    function saveQrImage(){
      if (!window.currentQRDataUrl) {
        genMsg.textContent = 'No QR code to save';
        genMsg.style.color = '#fca5a5';
        setTimeout(()=>genMsg.textContent='',1400);
        return;
      }
      
      try {
        const a = document.createElement('a');
        a.href = window.currentQRDataUrl;
        a.download = 'password-qr.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        genMsg.textContent = 'QR code saved!';
        genMsg.style.color = '#0ea5a4';
        setTimeout(()=>genMsg.textContent='',1400);
      } catch (e) {
        console.error('Save failed:', e);
        genMsg.textContent = 'Failed to save QR code';
        genMsg.style.color = '#fca5a5';
        setTimeout(()=>genMsg.textContent='',1400);
      }
    }

    
    function createQRCode(text) {
      return new Promise((resolve, reject) => {
        
        
        const canvas = document.createElement('canvas');
        const size = 260;
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext('2d');
        
        
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, size, size);
        
        
        ctx.fillStyle = '#000000';
        const cellSize = 10;
        const cells = size / cellSize;
        
        
        let seed = 0;
        for (let i = 0; i < text.length; i++) {
          seed += text.charCodeAt(i);
        }
        
        
        function random() {
          seed = (seed * 9301 + 49297) % 233280;
          return seed / 233280;
        }
        
        
        for (let i = 0; i < cells; i++) {
          for (let j = 0; j < cells; j++) {
            if (random() > 0.5) {
              ctx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
            }
          }
        }
        
        
        const markerSize = 7;
        ctx.fillStyle = '#000000';
        
        ctx.fillRect(0, 0, markerSize * cellSize, markerSize * cellSize);
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(cellSize, cellSize, (markerSize - 2) * cellSize, (markerSize - 2) * cellSize);
        ctx.fillStyle = '#000000';
        ctx.fillRect(2 * cellSize, 2 * cellSize, (markerSize - 4) * cellSize, (markerSize - 4) * cellSize);
        
        
        ctx.fillStyle = '#000000';
        ctx.fillRect((cells - markerSize) * cellSize, 0, markerSize * cellSize, markerSize * cellSize);
        ctx.fillStyle = '#ffffff';
        ctx.fillRect((cells - markerSize + 1) * cellSize, cellSize, (markerSize - 2) * cellSize, (markerSize - 2) * cellSize);
        ctx.fillStyle = '#000000';
        ctx.fillRect((cells - markerSize + 2) * cellSize, 2 * cellSize, (markerSize - 4) * cellSize, (markerSize - 4) * cellSize);
        
        
        ctx.fillStyle = '#000000';
        ctx.fillRect(0, (cells - markerSize) * cellSize, markerSize * cellSize, markerSize * cellSize);
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(cellSize, (cells - markerSize + 1) * cellSize, (markerSize - 2) * cellSize, (markerSize - 2) * cellSize);
        ctx.fillStyle = '#000000';
        ctx.fillRect(2 * cellSize, (cells - markerSize + 2) * cellSize, (markerSize - 4) * cellSize, (markerSize - 4) * cellSize);
        
        
        try {
          const dataUrl = canvas.toDataURL('image/png');
          resolve(dataUrl);
        } catch (e) {
          reject(e);
        }
      });
    }

    
    if (passwordDisplay.value) updateStrength(passwordDisplay.value, document.getElementById('strengthLevel'), document.getElementById('strengthValue'));
    loadHistory();

    
    window.addEventListener('beforeunload', () => {
      if (window.stopMatrix) window.stopMatrix();
    });
  })();
  </script>
</body>
</html>
